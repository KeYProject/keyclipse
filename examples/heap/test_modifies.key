\javaSource "src";

\programVariables {
    MyClass self;
    MyClass b;
}

\functions {
   Heap heapAtPre;
   Set modAtPre;
   
   //these would be automatically created on demand later, but we already need them here
   \unique Field MyClass::next;
   \unique Field MyClass::attr;
}


\problem {
    //Modifies clause is {self.next, b.next.next, b.next.next.next, self.attr}
    modAtPre = union(singleton(pair(self, MyClass::next)),
                     union(singleton(pair(b.next, MyClass::next)),
                           union(singleton(pair(b.next.next, MyClass::next)),
                                 singleton(pair(self, MyClass::attr)))))
      
    //atPre definitions                            
    & heap = heapAtPre
    
    ->
    
    \[{
          self.next = b.next.next;
          b.next.next = b;
          self.attr++;
    }\]
    
    
    //all heap locations must either be unchanged or be in the modifies clause
    (\forall Object o; \forall Field g; (
             any::select(heap, o, g) = any::select(heapAtPre, o, g)
             | elementOf(pair(o, g), modAtPre)
    ))
}  
