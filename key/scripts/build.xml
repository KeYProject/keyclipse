<?xml version="1.0"?>
<project name="key" default="compileAll" basedir=".">
	<property environment="env"/>

	<condition property="key.version" value="${env.KEY_VERSION}" else="2.5">
	   <isset property="env.KEY_VERSION"/>
	</condition>

	 <!-- The following tasks are for KeY -->
	<target name="start" depends="compileAll" description="Starts KeY.">
		<ant antfile="${basedir}/../key.ui/build.xml" target="start" dir="${basedir}/../key.ui" inheritall="false"/>
	</target>

	<target name="compileAll">
		<ant antfile="${basedir}/../key.util/build.xml" target="compile" dir="${basedir}/../key.util" inheritall="false"/>
		<ant antfile="${basedir}/../key.core/build.xml" target="compile" dir="${basedir}/../key.core" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.testgen/build.xml" target="compile" dir="${basedir}/../key.core.testgen" inheritall="false"/>
		<ant antfile="${basedir}/../key.ui/build.xml" target="compile" dir="${basedir}/../key.ui" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.symbolic_execution/build.xml" target="compile" dir="${basedir}/../key.core.symbolic_execution" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.proof_references/build.xml" target="compile" dir="${basedir}/../key.core.proof_references" inheritall="false"/>
	</target>

	<target name="deployAll" depends="cleanAll">
		<exec executable="git" outputproperty="git.revision">
		  <arg value="rev-parse"/>
		  <arg value="HEAD"/>
		</exec>	
		<zip destfile="${basedir}/../deployment/key-src-${key.version}_${git.revision}.zip"
		       basedir="${basedir}/../"
		       excludes="*-src-*,*.jnlp,**/deployment/**,**/bin/**,*~,**/oldStuff/**"
		 />
		<ant antfile="${basedir}/../key.util/build.xml" target="deploy" dir="${basedir}/../key.util" inheritall="false"/>
		<ant antfile="${basedir}/../key.core/build.xml" target="deploy" dir="${basedir}/../key.core" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.testgen/build.xml" target="deploy" dir="${basedir}/../key.core.testgen" inheritall="false"/>
		<ant antfile="${basedir}/../key.ui/build.xml" target="deploy" dir="${basedir}/../key.ui" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.symbolic_execution/build.xml" target="deploy" dir="${basedir}/../key.core.symbolic_execution" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.proof_references/build.xml" target="deploy" dir="${basedir}/../key.core.proof_references" inheritall="false"/>
		<copy todir="${basedir}/../deployment">
			<fileset file="${basedir}/../LICENSE.TXT"/>
		</copy>
		<zip destfile="${basedir}/../deployment/key-${key.version}_${git.revision}.zip"
		       basedir="${basedir}/../deployment"
		       excludes="*-src-*,**/key*-*.zip,*.jnlp"
		 />
	</target>

	<target name="cleanAll">
		<ant antfile="${basedir}/../key.util/build.xml" target="clean" dir="${basedir}/../key.util" inheritall="false"/>
		<ant antfile="${basedir}/../key.core/build.xml" target="clean" dir="${basedir}/../key.core" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.testgen/build.xml" target="clean" dir="${basedir}/../key.core.testgen" inheritall="false"/>
		<ant antfile="${basedir}/../key.ui/build.xml" target="clean" dir="${basedir}/../key.ui" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.symbolic_execution/build.xml" target="clean" dir="${basedir}/../key.core.symbolic_execution" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.proof_references/build.xml" target="clean" dir="${basedir}/../key.core.proof_references" inheritall="false"/>
	</target>

	<!-- The following tasks are for KeY's Tests -->
	<target name="runAllTests" depends="compileAllTests">
		<ant antfile="${basedir}/../key.util.test/build.xml" target="runTests" dir="${basedir}/../key.util.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.test/build.xml" target="runTests" dir="${basedir}/../key.core.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.testgen.test/build.xml" target="runTests" dir="${basedir}/../key.core.testgen.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.proof_references.test/build.xml" target="runTests" dir="${basedir}/../key.core.proof_references" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.symbolic_execution.test/build.xml" target="runTests" dir="${basedir}/../key.core.symbolic_execution.test" inheritall="false"/>
	</target>

	<target name="runAllTestsXML" depends="compileAllTests">
		<ant antfile="${basedir}/../key.util.test/build.xml" target="runTestsXML" dir="${basedir}/../key.util.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.test/build.xml" target="runTestsXML" dir="${basedir}/../key.core.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.testgen.test/build.xml" target="runTestsXML" dir="${basedir}/../key.core.testgen.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.proof_references.test/build.xml" target="runTestsXML" dir="${basedir}/../key.core.proof_references" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.symbolic_execution.test/build.xml" target="runTestsXML" dir="${basedir}/../key.core.symbolic_execution.test" inheritall="false"/>
	</target>

	<target name="compileAllTests" depends="deployAll">
		<ant antfile="${basedir}/../key.util.test/build.xml" target="compile" dir="${basedir}/../key.util.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.test/build.xml" target="compile" dir="${basedir}/../key.core.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.testgen.test/build.xml" target="compile" dir="${basedir}/../key.core.testgen.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.proof_references/build.xml" target="compile" dir="${basedir}/../key.core.proof_references" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.symbolic_execution.test/build.xml" target="compile" dir="${basedir}/../key.core.symbolic_execution.test" inheritall="false"/>
	</target>

	<target name="cleanAllTests">
		<ant antfile="${basedir}/../key.util.test/build.xml" target="clean" dir="${basedir}/../key.util.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.test/build.xml" target="clean" dir="${basedir}/../key.core.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.testgen.test/build.xml" target="clean" dir="${basedir}/../key.core.testgen.test" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.proof_references/build.xml" target="clean" dir="${basedir}/../key.core.proof_references" inheritall="false"/>
		<ant antfile="${basedir}/../key.core.symbolic_execution.test/build.xml" target="clean" dir="${basedir}/../key.core.symbolic_execution.test" inheritall="false"/>
	</target>
</project>
